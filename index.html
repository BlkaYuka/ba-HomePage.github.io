<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MILLENNIUM24 INSUBUNHAE STORE</title>
  <meta name="description" content="히어로 고정 + 스크롤 페이드 + 긴 이미지 풀스크롤 리빌" />
  <link rel="icon" href="./assets/favicon.png" />
  <link rel="preload" as="image" href="./assets/main-hero.png" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@500;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --ease: cubic-bezier(.22,.61,.36,1);
      --p: 0;           /* 스크롤 진행도(0~1) */
      --hero-o: 1.0;      /* 히어로 투명도 (JS가 세팅) */
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;overscroll-behavior-x:none;touch-action:pan-y}
    body{
      color:#0f172a;
      background:#0f2446 url('./assets/background.png?v=3') center/cover fixed no-repeat;
      overflow-x:hidden;
      font-family:'Pretendard',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    /* ===== Scroll Scene ===== */
    .scene{ position:relative; height:200vh; }             /* 실제 높이는 JS가 다시 설정 */
    .sticky{ position:sticky; top:0; height:100vh; overflow:hidden; }

    /* 배경 어둡게 (히어로 사라질수록 진해짐) */
    .sticky::after{
      content:""; position:absolute; inset:0; pointer-events:none; z-index:0;
      background: rgba(3,7,18, calc(var(--p) * 0.35));
    }

    /* ===== Hero (고정, 항상 최상단 레이어) ===== */
    .hero{position:relative; height:100%; display:flex; justify-content:center; align-items:center; z-index:3}
    .hero-shell{position:relative; width:min(1180px,92vw); margin:0 auto}
    .hero-inner{display:flex; flex-direction:column; align-items:center; gap:1.2rem}

    .hero-banner{display:block; width:min(400px,64vw); max-width:100%;
      border-radius:1rem; mix-blend-mode:screen; filter:drop-shadow(0 18px 48px rgba(8,30,60,.38));
      opacity:0}
    .hero-banner-top{margin-bottom:.6rem}
    .hero-banner-bottom{margin-top:.6rem}
    .hero-bottom{position:relative; display:inline-flex; align-items:flex-end; justify-content:center; width:100%;}
    .hero-location-shell{position:absolute; left:0; top:50%; transform:translate(-48%, -52%); pointer-events:none;}
    .hero-play-shell{position:absolute; right:0; top:50%; transform:translate(48%, -52%); pointer-events:none;}
    .hero-location{display:block; width:min(220px,32vw); max-width:210px; pointer-events:auto; cursor:pointer;
      opacity:0; filter:drop-shadow(0 12px 30px rgba(8,30,60,.32)); transition:filter .2s var(--ease);
      transform-origin:52% 48%;
    }
    .hero-location:hover{filter:drop-shadow(0 16px 36px rgba(8,30,60,.42));}
    .hero-play{display:block; width:min(220px,32vw); max-width:230px; pointer-events:auto; cursor:pointer;
      opacity:0; filter:drop-shadow(0 12px 30px rgba(8,30,60,.32)); transition:filter .2s var(--ease);
      transform-origin:48% 46%;
    }
    .hero-play:hover{filter:drop-shadow(0 16px 36px rgba(8,30,60,.42));}
    .hero-img{display:block; width:100%; max-width:min(660px,82vw); max-height:66vh; object-fit:contain;
      filter:drop-shadow(0 24px 60px rgba(15,23,42,.35)); opacity:0}

    /* 로딩 시 1회 등장 애니 */
    .ready .hero-banner.hero-banner-top{animation:slideDown .9s var(--ease) forwards}
    .ready .hero-img{animation:pop .95s var(--ease) .12s forwards}
    .ready .hero-banner.hero-banner-bottom{animation:slideUp .9s var(--ease) .22s forwards}
    .ready .hero-location{animation:cloudIn .95s var(--ease) .32s forwards; opacity:1;}
    .ready .hero-play{animation:cloudIn .95s var(--ease) .36s forwards; opacity:1;}
    @keyframes pop{0%{opacity:0;transform:translateY(8px) scale(.92)}60%{opacity:1;transform:translateY(0) scale(1.06)}100%{opacity:1;transform:translateY(0) scale(1)}}
    @keyframes slideDown{from{opacity:0;transform:translateY(-14px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
    @keyframes cloudIn{
      0%{opacity:0;transform:translate(-26px,-14px) scale(.92)}
      60%{opacity:1;transform:translate(8px,6px) scale(1.06)}
      100%{opacity:1;transform:translate(0,0) scale(1)}
    }
    @keyframes cloudShake{
      0%,100%{transform:translate(0,0) rotate(0)}
      20%{transform:translate(8px,-2px) rotate(2deg)}
      40%{transform:translate(-10px,2px) rotate(-2deg)}
      60%{transform:translate(6px,-1px) rotate(1.5deg)}
      80%{transform:translate(-7px,1px) rotate(-1.5deg)}
    }
    .hero-location.is-shaking{animation:cloudShake .6s ease; opacity:1;}

    /* 스크롤 중 히어로 페이드(위치 고정, 움직임 없음) */
    .hero-fade{
      transition: opacity .12s var(--ease);
      opacity: var(--hero-o, 1) !important;  /* JS 계산값만 사용 */
    }

    /* ===== info 이미지 (아래 레이어, 아래에서 위로 상승) ===== */
    .info-rail{
      position:absolute; top:0; left:50%; transform:translateX(-50%);
      height:100vh; z-index:1; pointer-events:none;
      will-change:transform;
    }
    .info-img{
      display:block; width:min(1100px,95vw); height:auto;
      border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
      opacity: calc(0.3 + var(--p)*3.8);          /* 진행하며 서서히 보이게 */
      transform: translateY(var(--info-y, 0px));     /* JS가 translateY 주입 */
      will-change: transform, opacity;
    }

    /* Popup */
    .popup{position:fixed; inset:0; z-index:20; display:flex; align-items:center; justify-content:center;}
    .popup[hidden]{display:none}
    .popup-backdrop{position:absolute; inset:0; background:rgba(2,6,23,.65); backdrop-filter:blur(6px);}
    .popup-card{position:relative; z-index:1; max-width:min(720px,92vw); background:rgba(15,23,42,.94);
      border-radius:18px; box-shadow:0 22px 60px rgba(2,6,23,.45); padding:32px 32px 28px;
    }
    .popup-img{display:block; width:100%; height:auto; border-radius:12px; box-shadow:0 10px 26px rgba(0,0,0,.28);}
    .popup-close{position:absolute; top:10px; right:14px; border:0; background:transparent; color:#e2e8f0;
      font-size:32px; line-height:1; cursor:pointer; padding:4px;
    }
    .popup-close:hover{color:#f8fafc}

    @media (prefers-reduced-motion:reduce){
      .hero-banner,.hero-img{opacity:1;animation:none !important;transform:none}
      .hero-location{opacity:1;animation:none !important;transform:none;}
      .hero-location.is-shaking{animation:none}
      .hero-fade{opacity:1;transition:none}
      .info-img{opacity:1;transform:none}
      .sticky::after{background:rgba(3,7,18,.12)}
    }

    @media (max-width:900px){
      .hero-inner{gap:1.2rem}
      .hero-img{max-width:74vw;max-height:60vh}
      .hero-banner{width:min(360px,82vw)}
      .hero-location{max-width:160px}
      .popup-card{padding:24px 24px 20px}
      .popup-close{top:6px; right:10px}
    }
  </style>
</head>
<body>

  <!-- ===== Scroll Scene ===== -->
  <section class="scene" id="scene">
    <div class="sticky" id="sticky">
      <!-- Hero -->
      <section id="hero" class="hero">
        <div class="hero-shell hero-fade">
          <div class="hero-inner">
            <img class="hero-banner hero-banner-top" src="./assets/top_banner.png" alt="상단 배너" decoding="async" />
            <img id="hero-img" class="hero-img" src="./assets/main-hero.png" alt="대표 이미지" decoding="async" fetchpriority="high" />
            <div class="hero-bottom">
              <div class="hero-location-shell">
                <img id="hero-location" class="hero-location" src="./assets/location.png" alt="위치 안내 구름" decoding="async"
                  role="button" tabindex="0" aria-haspopup="dialog" aria-controls="locationPopup" />
              </div>
              <div class="hero-play-shell">
                <img id="hero-play" class="hero-play"
                    src="./assets/play_game.png"
                    alt="게임 시작"
                    role="link" tabindex="0"
                    data-href="./games/game2" />
              </div>
              <img class="hero-banner hero-banner-bottom" src="./assets/bottom_banner.png" alt="하단 배너" decoding="async" />
            </div>
          </div>
        </div>
      </section>

      <!-- 긴 info 이미지 (예: 1500×8237) -->
      <div class="info-rail">
        <img class="info-img" id="infoImg" src="./assets/info.png" alt="판매 아이템 목록" loading="lazy" decoding="async" />
      </div>
    </div>
  </section>

  <div id="locationPopup" class="popup" hidden aria-hidden="true" tabindex="-1" role="dialog" aria-modal="true">
    <div class="popup-backdrop" data-popup-close></div>
    <div class="popup-card">
      <button type="button" class="popup-close" aria-label="닫기" data-popup-close>&times;</button>
      <img src="./assets/booth_position.png" alt="부스 위치" class="popup-img" decoding="async" />
    </div>
  </div>

  <script>
    // 로딩 후 초기 등장 애니 트리거
    (function(){
      const imgs = Array.from(document.querySelectorAll('.hero-banner, .hero-img, .hero-location, .hero-play'));
      let ready = 0;
      const fire = ()=>{ if(++ready >= imgs.length) document.body.classList.add('ready'); };
      imgs.forEach(img=>{ img.complete ? fire() : img.addEventListener('load', fire, { once:true }); });
      setTimeout(()=>document.body.classList.add('ready'), 1200);
    })();

    // sticky 씬: 이미지 실제 렌더 높이에 맞춰 높이/이동량 계산 + 진행도→투명도/이동 반영
    (function(){
      const clamp = (n,min,max)=>Math.min(Math.max(n,min),max);
      const scene = document.getElementById('scene');
      const infoImg = document.getElementById('infoImg');
      const heroShell = document.querySelector('.hero-shell');

      let vh=0, imgH=0, total=0, startY=0, endY=0;

      function measure(){
        vh = window.innerHeight || document.documentElement.clientHeight;

        // 현재 렌더 폭 기준 실제 이미지 높이 계산
        const renderedW = Math.min(1100, window.innerWidth * 0.95);
        if (infoImg.complete && infoImg.naturalWidth) {
          imgH = infoImg.naturalHeight * (renderedW / infoImg.naturalWidth);
        } else {
          // 로드 전 추정치(원본 1500x8237 가정)
          imgH = 8237 * (renderedW / 1500);
        }

        // 씬 높이: 히어로 100vh + 이미지 전부 + 마무리 여유 1vh (거의 딱 붙게)
        const sceneH = vh + imgH + Math.max(0.01*vh, 1);
        scene.style.height = `${sceneH}px`;

        // sticky 구간 스크롤 거리
        total = sceneH - vh;

        // 이미지 이동 범위: 화면 아래에서 시작해서 끝까지 올라오기
        startY = vh;             // 뷰포트 아래에서 시작
        endY   = -(imgH - vh);   // 이미지 상단이 상단에 닿을 때
      }

      let ticking = false;
      function apply(){
        const rect = scene.getBoundingClientRect();
        const scrolled = 0 - rect.top;
        const p = clamp(scrolled / total, 0, 1);

        // 히어로 빠르게 사라지게: p=0.25에서 완전 0
        const T = 0.13; // 더 빨리면 0.2, 더 늦게면 0.3~0.35
        const heroOpacity = 1 - Math.min(p / T, 1);

        document.documentElement.style.setProperty('--p', p.toFixed(4));
        document.documentElement.style.setProperty('--hero-o', heroOpacity.toFixed(4));

        const y = startY + (endY - startY) * p;
        infoImg.style.setProperty('--info-y', `${y.toFixed(2)}px`);

        // 히어로가 거의 0이면 클릭 막아 겹침 체감 제거
        heroShell.style.pointerEvents = heroOpacity < 0.05 ? 'none' : 'auto';

        ticking = false;
      }

      function onScroll(){ if (!ticking){ ticking = true; requestAnimationFrame(apply); } }
      function onResize(){ measure(); apply(); }

      if (!infoImg.complete) infoImg.addEventListener('load', onResize, { once:true });

      measure(); apply();
      window.addEventListener('scroll', onScroll, { passive:true });
      window.addEventListener('resize', onResize);
      window.addEventListener('orientationchange', onResize);
    })();

    (function(){
      const locationImg = document.getElementById('hero-location');
      const popup = document.getElementById('locationPopup');
      if(!locationImg || !popup) return;

      const closeTargets = popup.querySelectorAll('[data-popup-close]');
      let prevOverflow = '';

      const openPopup = ()=>{
        if(!popup.hidden) return;
        prevOverflow = document.documentElement.style.overflow;
        document.documentElement.style.overflow = 'hidden';
        popup.hidden = false;
        popup.setAttribute('aria-hidden', 'false');
        popup.focus?.();
      };

      const closePopup = ()=>{
        if(popup.hidden) return;
        popup.hidden = true;
        popup.setAttribute('aria-hidden', 'true');
        document.documentElement.style.overflow = prevOverflow;
        locationImg.focus();
      };

      const triggerShake = ()=>{
        locationImg.classList.remove('is-shaking');
        void locationImg.offsetWidth;
        locationImg.classList.add('is-shaking');
      };

      locationImg.addEventListener('click', ()=>{
        triggerShake();
        openPopup();
      });

      locationImg.addEventListener('keydown', (event)=>{
        if(event.key === 'Enter' || event.key === ' '){
          event.preventDefault();
          triggerShake();
          openPopup();
        }
      });

      locationImg.addEventListener('animationend', (event)=>{
        if(event.animationName === 'cloudShake'){
          locationImg.classList.remove('is-shaking');
        }
      });

      closeTargets.forEach(el=>{
        el.addEventListener('click', closePopup);
      });

      window.addEventListener('keydown', (event)=>{
        if(event.key === 'Escape') closePopup();
      });
    })();
        (function(){
          const playImg = document.getElementById('hero-play');
          if(!playImg) return;

          const go = () => {
            const href = playImg.dataset.href || './game2';
            window.location.href = href;
          };

          playImg.addEventListener('click', go);
          playImg.addEventListener('keydown', (e)=>{
            if(e.key === 'Enter' || e.key === ' '){
              e.preventDefault();
              go();
            }
          });
        })();
  </script>
</body>
</html>
